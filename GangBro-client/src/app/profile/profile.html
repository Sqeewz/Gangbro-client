<div class="profile-container">
    <!-- User Header Section -->
    <div class="user-header">
        <div class="avatar-wrapper" (click)="openDialog()">
            <img [src]="avatar_url()" alt="User Avatar" class="user-avatar">
            <div class="overlay">
                <mat-icon>photo_camera</mat-icon>
                <span>RECALIBRATE</span>
            </div>
        </div>
        <div class="user-info">
            <h1 class="gang-title">{{ display_name() || 'UNIDENTIFIED_AGENT' }}</h1>
            <div class="status-indicator">
                <span class="pulse"></span>
                <p class="role">GANG_OPERATIVE [LEVEL_01]</p>
            </div>
        </div>
    </div>

    <!-- Stats Dashboard -->
    <div class="dashboard-grid">
        <div class="stat-card total">
            <div class="stat-icon"><mat-icon>history</mat-icon></div>
            <div class="stat-content">
                <span class="label">MISSION_LOGS</span>
                <p class="number">{{ historyCount() }}</p>
            </div>
        </div>
        <div class="stat-card open">
            <div class="stat-icon"><mat-icon>radio_button_checked</mat-icon></div>
            <div class="stat-content">
                <span class="label">OPEN_CONTRACTS</span>
                <p class="number">{{ openCount() }}</p>
            </div>
        </div>
        <div class="stat-card progress">
            <div class="stat-icon"><mat-icon>bolt</mat-icon></div>
            <div class="stat-content">
                <span class="label">ACTIVE_SORTIES</span>
                <p class="number">{{ inProgressCount() }}</p>
            </div>
        </div>
        <div class="stat-card completed">
            <div class="stat-icon"><mat-icon>check_circle</mat-icon></div>
            <div class="stat-content">
                <span class="label">SUCCESSFUL_OPS</span>
                <p class="number">{{ completedCount() }}</p>
            </div>
        </div>
        <div class="stat-card failed">
            <div class="stat-icon"><mat-icon>cancel</mat-icon></div>
            <div class="stat-content">
                <span class="label">FAILED_OPS</span>
                <p class="number">{{ failedCount() }}</p>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="profile-tabs">
        <div class="tab-item" [class.active]="activeTab() === 'active'" (click)="activeTab.set('active')">
            <span>ACTIVE OPS</span>
        </div>
        <div class="tab-item" [class.active]="activeTab() === 'archives'" (click)="activeTab.set('archives')">
            <span>ARCHIVES</span>
        </div>
        <div class="tab-item" [class.active]="activeTab() === 'training'" (click)="activeTab.set('training')">
            <span>TRAINING</span>
        </div>
        <div class="tab-indicator" [class]="activeTab()"></div>
    </div>

    <!-- Active Missions Section -->
    @if (activeTab() === 'active') {
    <div class="active-missions-section animate-fade-in">
        <div class="section-header">
            <h2 class="section-title">ACTIVE_OPERATIONS</h2>
            <button class="gang-btn sm" (click)="onAdd()">NEW MISSION</button>
        </div>

        @if (isLoading()) {
        <div class="loading-state">
            <div class="cyber-spinner"></div>
            <p>SYNCING_DATA_CORES...</p>
        </div>
        } @else if (activeMissions().length === 0) {
        <div class="empty-state">
            <mat-icon>security_update_warning</mat-icon>
            <p>NO ACTIVE CONTRACTS DETECTED</p>
        </div>
        } @else {
        <div class="active-grid">
            @for (m of activeMissions(); track m.id) {
            <div class="active-card" [class.chief-mode]="isChief(m)">
                <div class="card-glow"></div>
                <div class="category-tag">
                    <mat-icon>{{ getCategoryIcon(m.category) }}</mat-icon>
                    <span>{{ m.category }}</span>
                </div>
                <h3 class="mission-name">{{ m.name }}</h3>
                <div class="mission-meta">
                    <span class="status-badge" [class]="m.status">{{ m.status }}</span>
                    <span class="crew-count">CREW: {{ m.crew_count }}</span>
                </div>
                <div class="card-actions">
                    <button class="action-btn intel" (click)="onViewAbout(m.id)">INTEL</button>
                    @if (isChief(m)) {
                    <button class="action-btn edit" (click)="onEdit(m)">EDIT</button>
                    }
                    <button class="action-btn execute"
                        [disabled]="isChief(m) && m.status === 'Open' && m.crew_count < 2" (click)="onExecute(m)">
                        {{ getExecuteText(m) }}
                    </button>
                </div>
            </div>
            }
        </div>
        }
    </div>
    }

    <!-- Mission History Logs -->
    @if (activeTab() === 'archives') {
    <div class="history-section animate-fade-in">
        <h2 class="section-title">CHRONOLOGICAL_LOGS</h2>

        @if (isLoading()) {
        <div class="loading-state">
            <div class="cyber-spinner"></div>
            <p>SYNCING_DATA_CORES...</p>
        </div>
        } @else if (historyMissions().length === 0) {
        <div class="empty-state">
            <mat-icon>storage</mat-icon>
            <p>NO ARCHIVED DATA FOUND IN SYSTEM</p>
        </div>
        } @else {
        <div class="mission-grid">
            @for (m of historyMissions(); track m.id) {
            <div class="history-card" [class.success]="m.status === 'Completed'" [class.fail]="m.status === 'Failed'">
                <div class="card-glow"></div>
                <div class="card-header">
                    <span class="mission-name">{{ m.name | uppercase }}</span>
                    <span class="status-tag" [class]="m.status | lowercase">{{ m.status }}</span>
                </div>
                <p class="description">{{ m.description || 'CLEARED_DOCUMENTATION' }}</p>
                <div class="card-footer">
                    <div class="meta-item">
                        <mat-icon>person</mat-icon>
                        <span>{{ m.chief_display_name }}</span>
                    </div>
                    <div class="meta-item">
                        <mat-icon>event</mat-icon>
                        <span>{{ m.created_at | date:'dd.MM.YY' }}</span>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </div>
    }

    <!-- Training Placeholder -->
    @if (activeTab() === 'training') {
    <div class="training-section animate-fade-in">
        <div class="empty-state training">
            <mat-icon>terminal</mat-icon>
            <p>TRAINING_SIMULATOR: OFFLINE</p>
            <span class="sub-text">ENCRYPTION_KEY_REQUIRED</span>
        </div>
    </div>
    }
</div>